{
    "inherit": "vshaxe-node",
    "haxelibs": [
        {
            "name": "hxargs",
            "installArgs": ["install", "hxargs"]
        },
        {
            "name": "haxe-hxparser",
            "installArgs": ["git", "haxe-hxparser", "https://github.com/vshaxe/haxe-hxparser"]
        },
        {
            "name": "compiletime",
            "installArgs": ["install", "compiletime"]
        },
        {
            "name": "mockatoo",
            "installArgs": ["git", "mockatoo", "https://github.com/grosmar/mockatoo", "master", "src"]
        },
        {
            "name": "mconsole",
            "installArgs": ["install", "mconsole"]
        },
        {
            "name": "yaml",
            "installArgs": ["install", "yaml"]
        },
        {
            "name": "plist",
            "installArgs": ["git", "plist", "https://github.com/back2dos/plist"]
        }
    ],
    "targets": [
        {
            "name": "all",
            "composite": true,
            "targetDependencies": [
                "test",
                "tm-language"
            ]
        },
        {
            "name": "test",
            "composite": true,
            "targetDependencies": [
                "vshaxe",
                "language-server-tests",
                "formatter"
            ],
            "isTestCommand": true,
            "args": {
                "debug": true
            }
        },
        {
            "name": "vshaxe",
            "composite": true,
            "targetDependencies": [
                "client",
                "language-server"
            ],
            "isBuildCommand": true
        },
        {
            "name": "client",
            "installCommands": [
                ["npm", "install"]
            ],
            "args": {
                "classPaths": [
                "vscode-extern/src",
                "src"
                ],
                "defines": [
                    "hxnodejs-no-version-warning",
                    "analyzer-optimize",
                    "JSTACK_MAIN=vshaxe.Main.main"
                ],
                "output": {
                    "target": "js",
                    "path": "bin/client.js"
                },
                "deadCodeElimination": "full",
                "packageName": "vshaxe.Main"
            }
        },
        {
            "name": "language-server",
            "args": {
                "haxelibs": ["haxe-hxparser"],
                "workingDirectory": "server",
                "classPaths": [
                    "src",
                    "protocol/src",
                    "formatter/src"
                ],
                "defines": [
                    "hxnodejs-no-version-warning"
                ],
                "output": {
                    "target": "js",
                    "path": "../bin/server.js"
                },
                "deadCodeElimination": "full",
                "main": "haxeLanguageServer.Main"
            }
        },
        {
            "name": "language-server-tests",
            "args": {
                "haxelibs": ["haxe-hxparser", "compiletime", "mockatoo", "mconsole"],
                "workingDirectory": "server",
                "classPaths": [
                    "src",
                    "test",
                    "protocol/src",
                    "formatter/src"
                ],
                "defines": [
                    "hxnodejs-no-version-warning"
                ],
                "output": {
                    "target": "js",
                    "path": "../bin/test.js"
                },
                "deadCodeElimination": "full",
                "noInline": true,
                "main": "TestMain",
                "debug": true
            },
            "afterBuildCommands": [
                ["node", "../bin/test.js"]
            ]
        },
        {
            "name": "tm-language",
            "composite": true,
            "targetDependencies": [
                "tm-language-conversion",
                "tm-language-tests"
            ],
            "args": {
                "debug": true
            }
        },
        {
            "inherit": "empty",
            "name": "tm-language-conversion",
            "args": {
                "haxelibs": ["yaml", "plist"],
                "workingDirectory": "syntaxes",
                "classPaths": [
                    "src"
                ],
                "output": {
                    "target": "neko",
                    "path": "bin/convert.n"
                },
                "main": "Converter",

                "debug": true
            },
            "afterBuildCommands": [
                ["neko", "bin/convert.n"]
            ]
        },
        {
            "name": "tm-language-build-tests",
            "installCommands": [
                ["npm", "install", "vscode-textmate"]
            ],
            "args": {
                "workingDirectory": "syntaxes",
                "classPaths": [
                "src"
                ],
                "output": {
                    "target": "js",
                    "path": "bin/build.js"
                },
                "main": "Build",
                "debug": true
            },
            "afterBuildCommands": [
                ["node", "bin/build.js"]
            ]
        },
        {
            "name": "tm-language-tests",
            "targetDependencies": [
                "tm-language-build-tests"
            ],
            "args": {
                "workingDirectory": "syntaxes",
                "classPaths": [
                    "src"
                ],
                "output": {
                    "target": "js",
                    "path": "bin/test.js"
                },
                "main": "Test",
                "debug": true
            },
            "afterBuildCommands": [
                ["node", "bin/test.js"]
            ]
        },
        {
            "name": "formatter",
            "composite": true,
            "targetDependencies": [
                "formatter-cli",
                "formatter-tests"
            ]
        },
        {
            "name":  "formatter-cli",
            "args": {
                "haxelibs": ["haxe-hxparser", "hxargs"],
                "workingDirectory": "server/formatter",
                "classPaths": [
                    "src"
                ],
                "output": {
                    "target": "js",
                    "path": "bin/cli.js"
                },
                "main": "haxeFormatter.Cli"
            }
        },
        {
            "name": "formatter-tests",
            "args": {
                "haxelibs": ["haxe-hxparser"],
                "workingDirectory": "server/formatter",
                "classPaths": [
                    "src",
                    "test"
                ],
                "output": {
                    "target": "js",
                    "path": "bin/test.js"
                },
                "main": "haxeFormatter.TestMain",
                "debug": true
            },
            "afterBuildCommands": [
                ["node", "bin/test.js"]
            ]
        }
    ]
}